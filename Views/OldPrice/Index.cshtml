@{
    ViewData["Title"] = "舊價資料查詢";
}

<style>
    :root {
        --primary-green: #28a745;
        --light-green: #d4edda;
        --dark-green: #1e7e34;
        --muted-green: #6c757d;
    }

    .bg-primary-green {
        background-color: var(--primary-green) !important;
    }

    .text-primary-green {
        color: var(--primary-green) !important;
    }

    .btn-primary-green {
        background-color: var(--primary-green);
        border-color: var(--primary-green);
        color: white;
    }

        .btn-primary-green:hover {
            background-color: var(--dark-green);
            border-color: var(--dark-green);
        }

    .btn-outline-primary-green {
        background-color: transparent;
        border-color: var(--primary-green);
        color: var(--primary-green);
    }

        .btn-outline-primary-green:hover {
            background-color: var(--primary-green);
            color: white;
        }

    .table-hover tbody tr:hover {
        background-color: var(--light-green);
    }

    .card {
        border: 1px solid var(--primary-green);
    }

    .card-header {
        background-color: var(--light-green);
        border-bottom: 1px solid var(--primary-green);
    }

    .form-select:focus, .form-control:focus {
        border-color: var(--primary-green);
        box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
    }

    /* 查詢區域樣式 */
    .query-section {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 25px;
        border: 2px solid var(--primary-green);
    }

    .query-hint {
        background-color: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 12px;
        margin-bottom: 15px;
        border-radius: 4px;
    }

    .search-stats {
        background-color: #fff3e0;
        border-left: 4px solid #ff9800;
        padding: 10px;
        margin-top: 15px;
        border-radius: 4px;
        font-size: 0.9em;
    }

    .clear-option {
        color: #6c757d;
        font-style: italic;
    }
</style>

<div class="app-content-header">
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-6">
                <h3 class="mb-0">舊價資料查詢</h3>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-end">
                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">舊價資料查詢</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<!-- 舊價彈性查詢區域 -->
<div class="query-section">
    <h5 class="text-primary-green mb-3">
        <i class="fas fa-search"></i> 舊價資料查詢
    </h5>

    <div class="query-hint">
        <i class="fas fa-info-circle"></i>
        <strong>彈性查詢說明：</strong>可單獨選擇分類、廠商，或直接關鍵字搜尋。支援項目名稱、編碼、供應商、規格等欄位查詢。
    </div>

    <!-- 查詢條件 -->
    <div class="row">
        <!-- 主類 -->
        <div class="col-md-4 mb-3">
            <label class="form-label fw-bold text-primary-green">
                <i class="fas fa-layer-group"></i> 主類：
            </label>
            <select class="form-select" id="mainCategory">
                <option value="" class="clear-option">不限制（顯示全部）</option>
                <option value="裝修工程">裝修工程</option>
            </select>
        </div>

        <!-- 次類 -->
        <div class="col-md-4 mb-3">
            <label class="form-label fw-bold text-primary-green">
                <i class="fas fa-list"></i> 次類：
            </label>
            <select class="form-select" id="subCategory">
                <option value="" class="clear-option">不限制（顯示全部）</option>
                <option value="櫥櫃工程">櫥櫃工程</option>
            </select>
        </div>

        <!-- 廠商 -->
        <div class="col-md-4 mb-3">
            <label class="form-label fw-bold text-primary-green">
                <i class="fas fa-industry"></i> 廠商：
            </label>
            <select class="form-select" id="supplierSelect">
                <option value="" class="clear-option">不限制（顯示全部）</option>
                <option value="億成木業">億成木業</option>
                <option value="昇佳木業">昇佳木業</option>
                <option value="鑫豪廚具">鑫豪廚具</option>
            </select>
        </div>

        <!-- 品項 -->
        <div class="col-md-4 mb-3">
            <label class="form-label fw-bold text-primary-green">
                <i class="fas fa-box-open"></i> 項目：
            </label>
            <select class="form-select" id="itemSelect">
                <option value="" class="clear-option">不限制（顯示全部）</option>
                <option value="高櫃">高櫃</option>
                <option value="矮櫃">矮櫃</option>
            </select>
        </div>

        <!-- 關鍵字 -->
        <div class="col-md-12 mb-3">
            <label class="form-label fw-bold text-primary-green">
                <i class="fas fa-search"></i> 關鍵字搜尋：
            </label>
            <div class="input-group">
                <input type="text" class="form-control" id="keywordSearch"
                       placeholder="輸入項目名稱、編碼、供應商等..."
                       onkeypress="handleKeywordEnter(event)">
                <button class="btn btn-outline-primary-green" onclick="clearKeyword()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 查詢按鈕 -->
    <div class="row mt-3">
        <div class="col-12">
            <button class="btn btn-primary-green me-2" onclick="performSearch()">
                <i class="fas fa-search"></i> 執行查詢
            </button>
            <button class="btn btn-outline-primary-green me-2" onclick="resetSearch()">
                <i class="fas fa-undo"></i> 重置條件
            </button>
        </div>
    </div>

    <div class="search-stats" id="searchStats" style="display:none;">
        <i class="fas fa-chart-bar"></i>
        <span id="searchStatsText"></span>
    </div>
</div>

<!-- 舊價項目清單 -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0 text-primary-green">
            <i class="fas fa-list"></i> 舊價項目清單
        </h5>
    </div>

    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-success">
                    <tr>
                        <th>編號</th>
                        <th>供應商</th>
                        <th>主類</th>
                        <th>次類</th>
                        <th>項目</th>
                        <th>規格</th>
                        <th class="text-end">數量</th>
                        <th class="text-end">原單價</th>
                        <th class="text-end">原複價</th>
                        <th class="text-end">合約單價</th>
                        <th class="text-end">合約複價</th>
                    </tr>
                </thead>
                <tbody id="oldPriceList">
                    <tr>
                        <td colspan="11" class="text-center text-muted py-4">
                            <i class="fas fa-search fa-2x mb-2"></i><br>
                            請設定查詢條件後點擊「執行查詢」開始搜尋
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // 假資料
        const mockData = [
            { id: '001', supplier: '億成木業', mainCategory: '裝修工程', subCategory: '櫥櫃工程', item: '高櫃', spec: '系統櫃 E1 板材 含五金', quantity: 1, originalUnit: 1000, originalTotal: 1000, contractUnit: 950, contractTotal: 950 },
            { id: '002', supplier: '昇佳木業', mainCategory: '裝修工程', subCategory: '櫥櫃工程', item: '矮櫃', spec: '系統櫃 E1 板材', quantity: 2, originalUnit: 800, originalTotal: 1600, contractUnit: 760, contractTotal: 1520 },
            { id: '003', supplier: '億成木業', mainCategory: '裝修工程', subCategory: '櫥櫃工程', item: '高櫃', spec: '實木櫃體 含玻璃門片', quantity: 1, originalUnit: 2500, originalTotal: 2500, contractUnit: 2300, contractTotal: 2300 },
            { id: '004', supplier: '鑫豪廚具', mainCategory: '裝修工程', subCategory: '櫥櫃工程', item: '矮櫃', spec: '廚房下櫃 含人造石檯面', quantity: 3, originalUnit: 1200, originalTotal: 3600, contractUnit: 1150, contractTotal: 3450 }
        ];

        // 查詢
        function performSearch() {
            const mainCategory = document.getElementById('mainCategory').value;
            const subCategory = document.getElementById('subCategory').value;
            const supplier = document.getElementById('supplierSelect').value;
            const itemSelect = document.getElementById('itemSelect').value;
            const keyword = document.getElementById('keywordSearch').value.trim().toLowerCase();

            let filtered = mockData.filter(item => {
                if (mainCategory && item.mainCategory !== mainCategory) return false;
                if (subCategory && item.subCategory !== subCategory) return false;
                if (supplier && item.supplier !== supplier) return false;
                if (itemSelect && item.item !== itemSelect) return false;
                if (keyword) {
                    const text = `${item.id} ${item.supplier} ${item.mainCategory} ${item.subCategory} ${item.item} ${item.spec}`.toLowerCase();
                    if (!text.includes(keyword)) return false;
                }
                return true;
            });

            renderTable(filtered);
            const stats = document.getElementById('searchStats');
            const statsText = document.getElementById('searchStatsText');
            stats.style.display = 'block';
            statsText.textContent = `查詢完成！共找到 ${filtered.length} 筆符合條件的項目`;
        }

        // 渲染表格
        function renderTable(data) {
            const tbody = document.getElementById('oldPriceList');
            if (data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" class="text-center text-muted py-4">
                            <i class="fas fa-inbox fa-2x mb-2"></i><br>
                            查無符合條件的項目
                        </td>
                    </tr>`;
                return;
            }

            tbody.innerHTML = data.map(item => `
                <tr>
                    <td>${item.id}</td>
                    <td>${item.supplier}</td>
                    <td>${item.mainCategory}</td>
                    <td>${item.subCategory}</td>
                    <td>${item.item}</td>
                    <td>${item.spec}</td>
                    <td class="text-end">${item.quantity}</td>
                    <td class="text-end">$${item.originalUnit.toLocaleString()}</td>
                    <td class="text-end">$${item.originalTotal.toLocaleString()}</td>
                    <td class="text-end">$${item.contractUnit.toLocaleString()}</td>
                    <td class="text-end">$${item.contractTotal.toLocaleString()}</td>
                </tr>
            `).join('');
        }

        // 清除條件
        function resetSearch() {
            document.getElementById('mainCategory').value = '';
            document.getElementById('subCategory').value = '';
            document.getElementById('supplierSelect').value = '';
            document.getElementById('itemSelect').value = '';
            document.getElementById('keywordSearch').value = '';
            document.getElementById('searchStats').style.display = 'none';
            document.getElementById('oldPriceList').innerHTML = `
                <tr>
                    <td colspan="11" class="text-center text-muted py-4">
                        <i class="fas fa-search fa-2x mb-2"></i><br>
                        請設定查詢條件後點擊「執行查詢」開始搜尋
                    </td>
                </tr>`;
        }

        function clearKeyword() {
            document.getElementById('keywordSearch').value = '';
        }

        function handleKeywordEnter(e) {
            if (e.key === 'Enter') performSearch();
        }
    </script>
}
